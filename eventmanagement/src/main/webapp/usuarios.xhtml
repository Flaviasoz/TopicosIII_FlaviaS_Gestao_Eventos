<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
        <meta name="theme-color" content="#6366F1" />
    </f:facet>
    <title>Gerenciar Usuários - EventHub</title>

    <h:outputStylesheet name="css/home.css" library="eventhub-layout" />
    <h:outputStylesheet name="css/crud.css" library="eventhub-layout" />
    <link rel="stylesheet" href="https://unpkg.com/primeflex@3.3.1/primeflex.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet" />
</h:head>

<h:body class="p-component">
    <f:event type="preRenderView" listener="#{loginController.redirectIfNotLoggedIn}" />

    <h:form id="mainForm">
        <!-- Navbar Componente -->
        <ui:include src="/WEB-INF/navbar.xhtml">
            <ui:param name="activePage" value="usuarios" />
        </ui:include>

        <!-- Conteúdo Principal -->
        <div class="main-content-container">
            <div class="content-header">
                <h1 class="page-title">
                    <i class="pi pi-users"></i>
                    Gerenciar Usuários
                </h1>
                <p class="page-description">Gerencie todos os usuários do sistema</p>
            </div>

            <!-- Botões de Ação -->
            <div class="action-buttons">
                <p:commandButton value="Novo Usuário" 
                               icon="pi pi-plus" 
                               styleClass="p-button-primary"
                               action="#{usuarioController.prepararNovoUsuario}"
                               update="@form"
                               oncomplete="PF('usuarioDialog').show()" />
            </div>

            <!-- Tabela de Usuários -->
            <div class="data-table-container">
                <p:dataTable value="#{usuarioController.listarTodos()}" 
                           var="usuario" 
                           styleClass="p-datatable-striped p-datatable-gridlines"
                           paginator="true" 
                           rows="10"
                           paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                           rowsPerPageTemplate="5,10,20,50">
                    
                    <p:column headerText="ID" width="60">
                        <h:outputText value="#{usuario.codigo}" />
                    </p:column>
                    
                    <p:column headerText="Nome" width="200">
                        <h:outputText value="#{usuario.nome}" />
                    </p:column>
                    
                    <p:column headerText="Email" width="200">
                        <h:outputText value="#{usuario.email}" />
                    </p:column>
                    
                    <p:column headerText="CPF" width="120">
                        <h:outputText value="#{usuario.cpf}" />
                    </p:column>
                    
                    <p:column headerText="Nível" width="100">
                        <p:tag value="#{usuario.nivel}" 
                               styleClass="#{usuario.nivel == 'adm' ? 'badge-admin' : 'badge-cliente'}" />
                    </p:column>
                    
                    <p:column headerText="Data Cadastro" width="150">
                        <h:outputText value="#{usuarioController.formatarDataCadastro(usuario.dataCadastro)}" />
                    </p:column>
                    
                    <p:column headerText="Ações" width="150">
                        <div class="action-buttons-cell">
                            <p:commandButton icon="pi pi-eye" 
                                           styleClass="p-button-rounded p-button-text p-button-sm"
                                           action="#{usuarioController.detalhesUsuario(usuario)}"
                                           oncomplete="PF('detalhesDialog').show()" />
                            
                            <p:commandButton icon="pi pi-pencil" 
                                           styleClass="p-button-rounded p-button-text p-button-sm"
                                           action="#{usuarioController.prepararEditarUsuario(usuario)}"
                                           update="@form"
                                           oncomplete="PF('usuarioDialog').show()" />
                            
                            <p:commandButton icon="pi pi-trash" 
                                           styleClass="p-button-rounded p-button-text p-button-danger p-button-sm"
                                           action="#{usuarioController.excluirUsuario(usuario)}"
                                           update="@form"
                                           onclick="return confirm('Tem certeza que deseja excluir este usuário?')" />
                        </div>
                    </p:column>
                </p:dataTable>
            </div>
        </div>

        <!-- Dialog para Criar/Editar Usuário -->
        <p:dialog header="#{usuarioController.modoEdicao ? 'Editar Usuário' : 'Novo Usuário'}" 
                 widgetVar="usuarioDialog" 
                 modal="true" 
                 showEffect="fade" 
                 hideEffect="fade"
                 styleClass="dialog-form">
            
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome">Nome:</label>
                        <p:inputText id="nome" value="#{usuarioController.usuario.nome}" 
                                   styleClass="form-control" />
                    </div>
                    
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <p:inputText id="email" value="#{usuarioController.usuario.email}" 
                                   styleClass="form-control" />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cpf">CPF:</label>
                        <p:inputText id="cpf" value="#{usuarioController.usuario.cpf}" 
                                   styleClass="form-control" />
                    </div>
                    
                    <div class="form-group">
                        <label for="senha">Senha:</label>
                        <p:password id="senha" value="#{usuarioController.usuario.senha}" 
                                  styleClass="form-control" />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="nivel">Nível:</label>
                        <p:selectOneMenu id="nivel" value="#{usuarioController.usuario.nivel}" 
                                       styleClass="form-control">
                            <f:selectItem itemLabel="Cliente" itemValue="cliente" />
                            <f:selectItem itemLabel="Administrador" itemValue="adm" />
                        </p:selectOneMenu>
                    </div>
                </div>
            </div>
            
            <f:facet name="footer">
                <div class="dialog-footer">
                    <p:commandButton value="Salvar" 
                                   icon="pi pi-check" 
                                   styleClass="p-button-primary"
                                   action="#{usuarioController.salvarUsuario}"
                                   update="@form"
                                   oncomplete="if (!args.validationFailed) {PF('usuarioDialog').hide()}" />
                    
                    <p:commandButton value="Cancelar" 
                                   icon="pi pi-times" 
                                   styleClass="p-button-secondary"
                                   onclick="PF('usuarioDialog').hide()" />
                </div>
            </f:facet>
        </p:dialog>

        <!-- Dialog de Detalhes -->
        <p:dialog header="Detalhes do Usuário" 
                 widgetVar="detalhesDialog" 
                 modal="true" 
                 showEffect="fade" 
                 hideEffect="fade"
                 styleClass="dialog-details">
            
            <div class="details-container">
                <div class="detail-row">
                    <span class="detail-label">ID:</span>
                    <span class="detail-value">#{usuarioController.usuarioSelecionado.codigo}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Nome:</span>
                    <span class="detail-value">#{usuarioController.usuarioSelecionado.nome}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">#{usuarioController.usuarioSelecionado.email}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">CPF:</span>
                    <span class="detail-value">#{usuarioController.usuarioSelecionado.cpf}</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Nível:</span>
                    <span class="detail-value">
                        <p:tag value="#{usuarioController.usuarioSelecionado.nivel}" 
                               styleClass="#{usuarioController.usuarioSelecionado.nivel == 'adm' ? 'badge-admin' : 'badge-cliente'}" />
                    </span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">Data de Cadastro:</span>
                    <span class="detail-value">
                        #{usuarioController.formatarDataCadastro(usuarioController.usuarioSelecionado.dataCadastro)}
                    </span>
                </div>
            </div>
            
            <f:facet name="footer">
                <div class="dialog-footer">
                    <p:commandButton value="Fechar" 
                                   icon="pi pi-times" 
                                   styleClass="p-button-secondary"
                                   onclick="PF('detalhesDialog').hide()" />
                </div>
            </f:facet>
        </p:dialog>

        <!-- Mensagens -->
        <p:growl id="messages" showDetail="true" life="3000" />
    </h:form>

    <style>
        .badge-admin {
            background-color: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-cliente {
            background-color: #28a745;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .action-buttons-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .dialog-form {
            width: 600px;
        }
        
        .dialog-details {
            width: 500px;
        }
        
        .form-container {
            padding: 1rem 0;
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        
        .form-control {
            width: 100%;
        }
        
        .details-container {
            padding: 1rem 0;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 1rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .detail-label {
            font-weight: 600;
            color: #374151;
            width: 120px;
            flex-shrink: 0;
        }
        
        .detail-value {
            color: #6b7280;
        }
        
        .dialog-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            padding-top: 1rem;
        }
    </style>
</h:body>
</html> 